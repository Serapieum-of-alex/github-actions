# MkDocs Deploy Action Test Fixtures

This directory contains test fixtures for the `mkdocs-deploy` GitHub Action.

## Directory Structure

```
tests/mkdocs-deploy/
├── generate-pixi-locks.py          # Script to generate pixi.lock files
├── test-pull-request-pip-uv/       # PR trigger test (pip/uv)
│   ├── pyproject.toml
│   ├── mkdocs.yml
│   └── docs/
│       └── index.md
├── test-pull-request-pixi/         # PR trigger test (pixi)
│   ├── pyproject.toml
│   ├── pixi.lock                   # Generated by pixi
│   ├── mkdocs.yml
│   └── docs/
│       └── index.md
├── test-main-trigger/              # Main branch deployment test
│   ├── pyproject.toml
│   ├── mkdocs.yml
│   └── docs/
│       ├── index.md
│       └── about.md
├── test-release-trigger-pip-uv/    # Release deployment test (pip/uv)
│   ├── pyproject.toml
│   ├── mkdocs.yml
│   └── docs/
│       ├── index.md
│       └── release.md
├── test-release-trigger-pixi/      # Release deployment test (pixi)
│   ├── pyproject.toml
│   ├── pixi.lock                   # Generated by pixi
│   ├── mkdocs.yml
│   └── docs/
│       ├── index.md
│       └── release.md
├── test-custom-configuration/      # Custom config test
│   ├── pyproject.toml
│   ├── mkdocs.yml
│   └── docs/
│       └── index.md
├── test-error-no-docs-deps/        # Error scenario: no docs deps
│   ├── pyproject.toml
│   ├── mkdocs.yml
│   └── docs/
│       └── index.md
├── test-git-configuration/         # Git config test
│   ├── pyproject.toml
│   ├── mkdocs.yml
│   └── docs/
│       └── index.md
├── test-package-manager-commands/  # Package manager command tests
│   ├── pyproject.toml
│   ├── pixi.lock                   # Generated by pixi
│   ├── mkdocs.yml
│   └── docs/
│       └── index.md
└── test-release-tag-resolution/    # Release tag resolution test
    ├── pyproject.toml
    ├── mkdocs.yml
    └── docs/
        └── index.md
```

## Test Scenarios

### 1. test-pull-request-pip-uv
Tests pull request deployment with pip and uv package managers.
- **Package managers**: pip, uv
- **Dependencies**: mkdocs, mkdocs-material, mike (in both optional-dependencies and dependency-groups)

### 2. test-pull-request-pixi
Tests pull request deployment with pixi package manager.
- **Package manager**: pixi
- **Dependencies**: mkdocs, mkdocs-material, mike (in pixi features)
- **Note**: Requires `pixi.lock` file

### 3. test-main-trigger
Tests main branch deployment strategy.
- **Package manager**: uv
- **Dependencies**: mkdocs, mkdocs-material, mike
- **Content**: Home page + About page

### 4. test-release-trigger-pip-uv
Tests release deployment with pip and uv.
- **Package managers**: pip, uv
- **Dependencies**: mkdocs, mkdocs-material, mike
- **Content**: Home page + Release notes

### 5. test-release-trigger-pixi
Tests release deployment with pixi.
- **Package manager**: pixi
- **Dependencies**: mkdocs, mkdocs-material, mike
- **Content**: Home page + Release notes
- **Note**: Requires `pixi.lock` file

### 6. test-custom-configuration
Tests custom Python versions and multiple dependency groups.
- **Package manager**: uv
- **Python versions**: 3.11, 3.12
- **Groups**: docs, dev, test
- **Tests**: Different install-groups combinations

### 7. test-error-no-docs-deps
Tests error handling when docs dependencies are missing.
- **Package manager**: uv
- **Groups**: Only `dev` group (no `docs` group)
- **Expected**: Deployment should fail

### 8. test-git-configuration
Tests that the action properly configures git.
- **Package manager**: pip
- **Tests**: Git user.name and user.email configuration

### 9. test-package-manager-commands
Tests command execution for all package managers.
- **Package managers**: pip, uv, pixi
- **Tests**: Each package manager's installation commands
- **Note**: Includes pixi configuration, requires `pixi.lock`

### 10. test-release-tag-resolution
Tests release tag resolution logic.
- **Package manager**: uv
- **Tests**: Explicit release-tag vs automatic detection

## Generating pixi.lock Files

Pixi test fixtures require `pixi.lock` files. To generate them:

1. **Install pixi** (if not already installed):
   ```bash
   # Linux/macOS
   curl -fsSL https://pixi.sh/install.sh | bash
   
   # Windows
   winget install prefix-dev.pixi
   ```

2. **Generate lock files**:
   ```bash
   cd tests/mkdocs-deploy
   python generate-pixi-locks.py
   ```

This will generate `pixi.lock` files for:
- `test-pull-request-pixi/`
- `test-release-trigger-pixi/`
- `test-package-manager-commands/`

## Usage in Workflows

Test fixtures are copied to the repository root in the workflow:

```yaml
- name: Copy test fixture files
  run: |
    cp tests/mkdocs-deploy/test-<scenario>/pyproject.toml .
    cp tests/mkdocs-deploy/test-<scenario>/mkdocs.yml .
    cp -r tests/mkdocs-deploy/test-<scenario>/docs .
```

For pixi tests, the `pixi.lock` file is also copied if it exists.

## Modifying Test Fixtures

When modifying test fixtures:

1. Edit the files in the appropriate test directory
2. For pixi fixtures, regenerate the lock file locally for testing:
   ```bash
   cd tests/mkdocs-deploy/test-<scenario>
   pixi install  # Generates pixi.lock
   ```
3. **Do NOT commit `pixi.lock` files** - they are generated during CI runs
4. Commit only `pyproject.toml`, `mkdocs.yml`, and documentation changes

## Adding New Test Fixtures

To add a new test fixture:

1. Create a new directory: `tests/mkdocs-deploy/test-<name>/`
2. Add required files:
   - `pyproject.toml` (with dependencies)
   - `mkdocs.yml` (MkDocs configuration)
   - `docs/index.md` (documentation content)
3. For pixi tests, add pixi configuration to `pyproject.toml` and generate `pixi.lock`
4. Update the workflow to use the new fixture
5. Update this README

## Dependencies

All test fixtures use compatible dependency versions:
- **mkdocs**: >=1.5.0
- **mkdocs-material**: >=9.5.0 (pip/uv fixtures only)
- **mike**: >=2.1.0

## Notes

- Pixi fixtures use `conda-forge` channel
- Pixi fixtures support multiple platforms: `linux-64`, `osx-64`, `osx-arm64`, `win-64`
- All fixtures use Python >=3.11
- **Pixi.lock files are NOT committed to version control** - they must be generated locally
- The workflow will generate pixi.lock files on-the-fly if they don't exist
- For local testing, generate lock files using `python generate-pixi-locks.py`

