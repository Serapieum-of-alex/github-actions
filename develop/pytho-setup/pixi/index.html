<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Pixi - Command Test</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/version-select.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Command Test</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Test</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../VERSIONING/" class="nav-link">Versioning Guide for GitHub Actions</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Pytho setup</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../pip/" class="dropdown-item">Python Setup with pip - Complete Guide</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Pixi</a>
</li>
                                    
<li>
    <a href="../uv/" class="dropdown-item">Python Setup with uv - Complete Guide</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../pip/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../uv/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#table-of-contents" class="nav-link">Table of Contents</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#quick-start" class="nav-link">Quick Start</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#inputs-reference" class="nav-link">Inputs Reference</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#features" class="nav-link">Features</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#usage-scenarios" class="nav-link">Usage Scenarios</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#lock-file-management" class="nav-link">Lock File Management</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#environment-architecture" class="nav-link">Environment Architecture</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#caching-strategy" class="nav-link">Caching Strategy</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#testing-guide" class="nav-link">Testing Guide</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#troubleshooting" class="nav-link">Troubleshooting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#best-practices" class="nav-link">Best Practices</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#migration-guide" class="nav-link">Migration Guide</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#additional-resources" class="nav-link">Additional Resources</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#examples-repository" class="nav-link">Examples Repository</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#support" class="nav-link">Support</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>te a# Python Setup with pixi - Complete Guide</p>
<p>Composite GitHub Action for setting up Python environments with the pixi package manager, designed for projects using conda-forge packages and cross-platform development with <code>pyproject.toml</code>.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#inputs-reference">Inputs Reference</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#usage-scenarios">Usage Scenarios</a></li>
<li><a href="#basic-setup">Basic Setup</a></li>
<li><a href="#multiple-environments">Multiple Environments</a></li>
<li><a href="#environment-activation">Environment Activation</a></li>
<li><a href="#matrix-testing">Matrix Testing</a></li>
<li><a href="#complex-projects-with-features">Complex Projects with Features</a></li>
<li><a href="#caching">Caching</a></li>
<li><a href="#lock-file-management">Lock File Management</a></li>
<li><a href="#lock-file-verification">Lock File Verification</a></li>
<li><a href="#frozen-vs-locked-modes">Frozen vs Locked Modes</a></li>
<li><a href="#environment-architecture">Environment Architecture</a></li>
<li><a href="#caching-strategy">Caching Strategy</a></li>
<li><a href="#testing-guide">Testing Guide</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#best-practices">Best Practices</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p>This action provides a complete Python environment setup using <a href="https://prefix.dev/">pixi</a>, a fast package manager built on top of conda. It automatically:</p>
<ul>
<li>Installs pixi package manager</li>
<li>Validates lock file existence</li>
<li>Sets up one or more pixi environments</li>
<li>Activates a specified environment</li>
<li>Optionally caches environments for faster CI runs</li>
<li>Verifies lock file integrity (configurable)</li>
</ul>
<p><strong>Key Features:</strong>
- âœ… Support for conda-forge and other conda channels
- âœ… Cross-platform compatibility (Linux, macOS, Windows)
- âœ… Multiple environment support
- âœ… Feature-based dependency management
- âœ… Intelligent caching with lock file validation
- âœ… Lock file verification modes (locked/frozen)</p>
<p><strong>Location</strong>: <code>Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1</code></p>
<h2 id="quick-start">Quick Start</h2>
<h3 id="basic-usage-default-environment">Basic Usage (Default Environment)</h3>
<pre><code class="language-yaml">steps:
  - uses: actions/checkout@v5
  - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1

  # The default environment is automatically activated!
  - run: python --version
  - run: pytest
</code></pre>
<h3 id="with-multiple-environments">With Multiple Environments</h3>
<pre><code class="language-yaml">steps:
  - uses: actions/checkout@v5
  - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
    with:
      environments: 'dev test prod'
      activate-environment: 'dev'

  - run: pytest  # Runs in dev environment
</code></pre>
<h3 id="with-caching-enabled">With Caching Enabled</h3>
<pre><code class="language-yaml">steps:
  - uses: actions/checkout@v5
  - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
    with:
      cache: 'true'

  - run: python --version  # Much faster on subsequent runs!
</code></pre>
<h2 id="inputs-reference">Inputs Reference</h2>
<table>
<thead>
<tr>
<th>Input</th>
<th>Description</th>
<th>Required</th>
<th>Default</th>
<th>Valid Values</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>environments</code></td>
<td>Pixi environments to install</td>
<td>No</td>
<td><code>'default'</code></td>
<td>Space-separated list (e.g., <code>'py311'</code>, <code>'dev test prod'</code>)</td>
</tr>
<tr>
<td><code>activate-environment</code></td>
<td>Environment to activate after installation</td>
<td>No</td>
<td><code>'default'</code></td>
<td>Any environment name from your <code>pyproject.toml</code></td>
</tr>
<tr>
<td><code>cache</code></td>
<td>Enable caching of pixi environments</td>
<td>No</td>
<td><code>'false'</code></td>
<td><code>'true'</code>, <code>'false'</code></td>
</tr>
<tr>
<td><code>verify-lock</code></td>
<td>Verify lock file is up to date</td>
<td>No</td>
<td><code>'true'</code></td>
<td><code>'true'</code>, <code>'false'</code></td>
</tr>
</tbody>
</table>
<h3 id="input-details">Input Details</h3>
<h4 id="environments"><code>environments</code></h4>
<p>Specifies which pixi environments from <code>[tool.pixi.environments]</code> in <code>pyproject.toml</code> to install.</p>
<p><strong>Default behavior (<code>'default'</code>)</strong>: Installs only the default environment.</p>
<p><strong>When specified</strong>: Installs all specified environments. This is useful when you need to prepare multiple environments or when running matrix tests.</p>
<p><strong>Formats supported:</strong>
- Single environment: <code>'dev'</code>
- Space-separated: <code>'dev test prod'</code>
- Multiple runs: You can call the action multiple times with different environments (though not recommended - see best practices)</p>
<p><strong>Example <code>pyproject.toml</code>:</strong></p>
<pre><code class="language-toml">[tool.pixi.environments]
default = [&quot;core&quot;]
dev = [&quot;core&quot;, &quot;dev-tools&quot;]
test = [&quot;core&quot;, &quot;test-tools&quot;]
prod = [&quot;core&quot;]
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-yaml"># Install only dev environment
environments: 'dev'

# Install dev and test environments
environments: 'dev test'

# Install all environments
environments: 'default dev test prod'
</code></pre>
<h4 id="activate-environment"><code>activate-environment</code></h4>
<p>Specifies which environment to activate in the GitHub Actions PATH after installation.</p>
<p><strong>Default behavior (<code>'default'</code>)</strong>: Activates the default environment.</p>
<p><strong>Important</strong>: This should be ONE of the environments listed in the <code>environments</code> input. If you specify an environment that wasn't installed, the action will fail.</p>
<p><strong>Example:</strong></p>
<pre><code class="language-yaml"># Install multiple environments but activate only 'dev'
with:
  environments: 'dev test prod'
  activate-environment: 'dev'
</code></pre>
<p>After activation:
- Python and packages from the activated environment are available in PATH
- All subsequent steps use this environment
- You can run <code>pixi run -e &lt;env&gt;</code> to run commands in other environments</p>
<h4 id="cache"><code>cache</code></h4>
<p>Controls whether to cache the pixi environments directory (<code>.pixi</code>) for faster CI runs.</p>
<p><strong>Default: <code>'false'</code></strong> - No caching by default to ensure clean environments unless explicitly requested.</p>
<p><strong>When <code>'true'</code></strong>:
- Caches the <code>.pixi</code> directory based on <code>pixi.lock</code> hash
- Cache is only written on <code>push</code> events to the <code>main</code> branch
- Significantly speeds up subsequent CI runs (from minutes to seconds)
- <strong>Requires <code>pixi.lock</code> file</strong> - will fail with a clear error if missing</p>
<p><strong>Cache key structure</strong>: <code>pixi-&lt;hash-of-pixi.lock&gt;</code></p>
<p><strong>Cache write behavior</strong>: Only writes cache when:
- <code>cache: 'true'</code> is set
- Event is <code>push</code> (not PR)
- Branch is <code>main</code></p>
<p><strong>Example:</strong></p>
<pre><code class="language-yaml"># Enable caching (recommended for production)
cache: 'true'

# Disable caching (useful for debugging)
cache: 'false'
</code></pre>
<h4 id="verify-lock"><code>verify-lock</code></h4>
<p>Controls lock file verification behavior and pixi installation mode.</p>
<p><strong>Default: <code>'true'</code></strong> - Always verify lock file is up to date.</p>
<p><strong>When <code>'true'</code> (locked mode)</strong>:
- Uses <code>pixi install --locked</code>
- Verifies that <code>pixi.lock</code> matches <code>pyproject.toml</code>
- <strong>Fails if lock file is outdated</strong> - prevents installing mismatched dependencies
- Recommended for CI/CD to catch lock file drift</p>
<p><strong>When <code>'false'</code> (frozen mode)</strong>:
- Uses <code>pixi install --frozen</code>
- Uses lock file as-is without verification
- Faster but won't catch outdated lock files
- Useful when you're certain the lock file is correct</p>
<p><strong>Example:</strong></p>
<pre><code class="language-yaml"># Verify lock file (default, recommended for CI)
verify-lock: 'true'

# Skip verification (faster, use cautiously)
verify-lock: 'false'
</code></pre>
<h2 id="features">Features</h2>
<h3 id="1-automatic-lock-file-validation">1. Automatic Lock File Validation</h3>
<p>The action <strong>always requires a <code>pixi.lock</code> file</strong> to be present in your repository. This ensures reproducible builds across all environments.</p>
<p><strong>What happens:</strong>
1. âœ… Checks if <code>pixi.lock</code> exists
2. âŒ Fails with a clear error message if missing
3. ğŸ“ Provides instructions on how to generate the lock file locally</p>
<p><strong>Error message when lock file is missing:</strong></p>
<pre><code>âŒ pixi.lock file does not exist!
To fix this issue:
 Run 'pixi install' locally to generate pixi.lock and commit it to your repository
This action requires a committed lock file and will never generate it in CI.
</code></pre>
<p><strong>Why this design?</strong>
- Lock files should be generated on the developer's machine, not in CI
- Ensures all developers and CI use the same dependency versions
- Prevents CI from making commits or masking dependency conflicts
- Makes dependency updates explicit and reviewable</p>
<h3 id="2-dual-mode-installation-locked-vs-frozen">2. Dual Mode Installation: Locked vs Frozen</h3>
<p>The action supports two installation modes controlled by the <code>verify-lock</code> input:</p>
<p><strong>Locked Mode (<code>verify-lock: 'true'</code> - default):</strong></p>
<pre><code class="language-bash">pixi install --locked
</code></pre>
<ul>
<li>Verifies <code>pixi.lock</code> matches <code>pyproject.toml</code></li>
<li>Fails if dependencies were added/removed without updating lock file</li>
<li><strong>Best for</strong>: CI/CD pipelines, ensuring strict reproducibility</li>
</ul>
<p><strong>Frozen Mode (<code>verify-lock: 'false'</code>):</strong></p>
<pre><code class="language-bash">pixi install --frozen
</code></pre>
<ul>
<li>Uses <code>pixi.lock</code> without verification</li>
<li>Faster but won't detect lock file drift</li>
<li><strong>Best for</strong>: Local development, trusted environments</li>
</ul>
<p><strong>Comparison:</strong></p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Flag</th>
<th>Verifies Lock</th>
<th>Speed</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>Locked</td>
<td><code>--locked</code></td>
<td>âœ… Yes</td>
<td>Slower</td>
<td>CI/CD, production</td>
</tr>
<tr>
<td>Frozen</td>
<td><code>--frozen</code></td>
<td>âŒ No</td>
<td>Faster</td>
<td>Development, trusted deploys</td>
</tr>
</tbody>
</table>
<h3 id="3-environment-information-logging">3. Environment Information Logging</h3>
<p>After installation, the action automatically logs environment information:</p>
<p><strong>Pixi Information:</strong></p>
<pre><code>Active environment: dev
Available environments:
  - default
  - dev
  - test
  - prod
</code></pre>
<p><strong>Installed Packages:</strong></p>
<pre><code>Installed packages summary:
  python 3.11.7
  numpy 1.26.2
  pandas 2.1.4
  pytest 7.4.3
  ...
</code></pre>
<p>This appears in collapsible sections in GitHub Actions logs for easy debugging.</p>
<h3 id="4-intelligent-caching">4. Intelligent Caching</h3>
<p>When <code>cache: 'true'</code> is enabled:</p>
<p><strong>Cache Behavior:</strong>
- <strong>Key</strong>: <code>pixi-&lt;hash(pixi.lock)&gt;</code>
- <strong>Cached</strong>: <code>.pixi/</code> directory (all environments)
- <strong>Write</strong>: Only on <code>push</code> to <code>main</code> branch
- <strong>Read</strong>: All runs (including PRs)</p>
<p><strong>Performance Impact:</strong>
- ğŸŒ First run: ~5-10 minutes (install all packages)
- ğŸš€ Cached run: ~30 seconds (restore cache + verification)</p>
<p><strong>Cache Invalidation:</strong>
- Automatic when <code>pixi.lock</code> changes
- Manual: bump version in <code>pyproject.toml</code> or clear GitHub cache</p>
<h3 id="5-cross-platform-support">5. Cross-Platform Support</h3>
<p>The action works seamlessly across:
- ğŸ§ <strong>Linux</strong> (ubuntu-latest)
- ğŸ <strong>macOS</strong> (macos-latest, macos-13, macos-14)
- ğŸªŸ <strong>Windows</strong> (windows-latest)</p>
<p>Shell commands automatically adapt to the platform (bash on Linux/macOS, PowerShell on Windows).</p>
<h3 id="6-multiple-environment-management">6. Multiple Environment Management</h3>
<p>Install and manage multiple environments in a single workflow:</p>
<pre><code class="language-yaml">- uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    environments: 'py311 py312 py313'
    activate-environment: 'py311'

# py311 is active by default
- run: python --version  # Python 3.11

# Switch to another environment for specific commands
- run: pixi run -e py312 python --version  # Python 3.12
- run: pixi run -e py313 pytest  # Run tests in Python 3.13
</code></pre>
<h2 id="usage-scenarios">Usage Scenarios</h2>
<h3 id="basic-setup">Basic Setup</h3>
<p><strong>Scenario</strong>: Simple project with a single environment.</p>
<p><strong><code>pyproject.toml</code>:</strong></p>
<pre><code class="language-toml">[project]
name = &quot;my-project&quot;
version = &quot;0.1.0&quot;

[tool.pixi.workspace]
channels = [&quot;conda-forge&quot;]
platforms = [&quot;linux-64&quot;, &quot;osx-64&quot;, &quot;win-64&quot;]

[tool.pixi.dependencies]
python = &quot;&gt;=3.11&quot;
numpy = &quot;&gt;=1.26&quot;
pytest = &quot;&gt;=7.0&quot;
</code></pre>
<p><strong>Workflow:</strong></p>
<pre><code class="language-yaml">name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup Python with pixi
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          cache: 'false'

      - name: Run tests
        run: pytest

      - name: Verify installation
        run: |
          python --version
          python -c &quot;import numpy; print(f'NumPy {numpy.__version__}')&quot;
</code></pre>
<p><strong>Result</strong>: Default environment is installed and activated, all packages available.</p>
<h3 id="multiple-environments">Multiple Environments</h3>
<p><strong>Scenario</strong>: Project with separate development and production environments.</p>
<p><strong><code>pyproject.toml</code>:</strong></p>
<pre><code class="language-toml">[tool.pixi.workspace]
channels = [&quot;conda-forge&quot;]
platforms = [&quot;linux-64&quot;, &quot;osx-64&quot;, &quot;win-64&quot;]

[tool.pixi.dependencies]
python = &quot;&gt;=3.11&quot;

[tool.pixi.feature.core.dependencies]
numpy = &quot;&gt;=1.26&quot;
pandas = &quot;&gt;=2.0&quot;

[tool.pixi.feature.dev.dependencies]
pytest = &quot;&gt;=7.0&quot;
black = &quot;&gt;=23.0&quot;
ruff = &quot;&gt;=0.1&quot;

[tool.pixi.feature.prod.dependencies]
gunicorn = &quot;&gt;=21.0&quot;

[tool.pixi.environments]
default = [&quot;core&quot;]
dev = [&quot;core&quot;, &quot;dev&quot;]
prod = [&quot;core&quot;, &quot;prod&quot;]
</code></pre>
<p><strong>Workflow:</strong></p>
<pre><code class="language-yaml">jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup dev environment
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: 'dev'
          activate-environment: 'dev'
          cache: 'false'

      - name: Run linting
        run: |
          black --check .
          ruff check .

      - name: Run tests
        run: pytest

  deploy-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup prod environment
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: 'prod'
          activate-environment: 'prod'
          cache: 'false'

      - name: Verify prod dependencies
        run: |
          python -c &quot;import gunicorn&quot;
          python -c &quot;import numpy, pandas&quot;
</code></pre>
<p><strong>Result</strong>: Different jobs use different environments with appropriate dependencies.</p>
<h3 id="environment-activation">Environment Activation</h3>
<p><strong>Scenario</strong>: Install multiple environments but work primarily in one.</p>
<p><strong><code>pyproject.toml</code>:</strong></p>
<pre><code class="language-toml">[tool.pixi.feature.core.dependencies]
python = &quot;&gt;=3.11&quot;
requests = &quot;&gt;=2.31&quot;

[tool.pixi.feature.dev.dependencies]
pytest = &quot;&gt;=7.0&quot;
black = &quot;&gt;=23.0&quot;

[tool.pixi.feature.test.dependencies]
pytest = &quot;&gt;=7.0&quot;
pytest-cov = &quot;&gt;=4.0&quot;
hypothesis = &quot;&gt;=6.0&quot;

[tool.pixi.environments]
default = [&quot;core&quot;]
dev = [&quot;core&quot;, &quot;dev&quot;]
test = [&quot;core&quot;, &quot;test&quot;]
</code></pre>
<p><strong>Workflow:</strong></p>
<pre><code class="language-yaml">jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup all environments
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: 'dev test'
          activate-environment: 'dev'  # Dev is active by default
          cache: 'false'

      - name: Run linting (uses active dev environment)
        run: black --check .

      - name: Run tests (switch to test environment)
        run: pixi run -e test pytest --cov

      - name: Check coverage (in test environment)
        run: pixi run -e test coverage report
</code></pre>
<p><strong>Result</strong>: Multiple environments available, explicit control over which is active.</p>
<h3 id="matrix-testing">Matrix Testing</h3>
<p><strong>Scenario</strong>: Test across multiple Python versions or OS combinations.</p>
<p><strong><code>pyproject.toml</code>:</strong></p>
<pre><code class="language-toml">[tool.pixi.workspace]
channels = [&quot;conda-forge&quot;]
platforms = [&quot;linux-64&quot;, &quot;osx-64&quot;, &quot;osx-arm64&quot;, &quot;win-64&quot;]

[tool.pixi.dependencies]
python = &quot;&gt;=3.11&quot;

[tool.pixi.feature.py311.dependencies]
python = &quot;3.11.*&quot;
pandas = &quot;&gt;=2.0&quot;

[tool.pixi.feature.py312.dependencies]
python = &quot;3.12.*&quot;
scikit-learn = &quot;&gt;=1.3&quot;

[tool.pixi.environments]
default = []
py311 = [&quot;py311&quot;]
py312 = [&quot;py312&quot;]
</code></pre>
<p><strong>Workflow:</strong></p>
<pre><code class="language-yaml">jobs:
  test-matrix:
    name: Test Python ${{ matrix.python-env }} on ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        python-env: ['py311', 'py312']
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v5

      - name: Setup Python environment
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: ${{ matrix.python-env }}
          activate-environment: ${{ matrix.python-env }}
          cache: 'false'

      - name: Run tests
        run: |
          python --version
          pytest
</code></pre>
<p><strong>Result</strong>: Tests run on 6 combinations (3 OS Ã— 2 Python versions), each with correct environment.</p>
<h3 id="complex-projects-with-features">Complex Projects with Features</h3>
<p><strong>Scenario</strong>: Large project with multiple feature sets (ML, visualization, development tools).</p>
<p><strong><code>pyproject.toml</code>:</strong></p>
<pre><code class="language-toml">[project]
name = &quot;complex-ml-project&quot;
version = &quot;0.1.0&quot;

[tool.pixi.workspace]
channels = [&quot;conda-forge&quot;, &quot;pytorch&quot;]
platforms = [&quot;linux-64&quot;, &quot;osx-64&quot;, &quot;osx-arm64&quot;, &quot;win-64&quot;]

[tool.pixi.tasks]
test = &quot;pytest tests/&quot;
lint = &quot;ruff check .&quot;
train = &quot;python scripts/train.py&quot;

[tool.pixi.dependencies]
python = &quot;&gt;=3.11,&lt;3.13&quot;

[tool.pixi.feature.core.dependencies]
numpy = &quot;&gt;=1.26&quot;
pandas = &quot;&gt;=2.0&quot;
scipy = &quot;&gt;=1.11&quot;

[tool.pixi.feature.ml.dependencies]
scikit-learn = &quot;&gt;=1.3&quot;
xgboost = &quot;&gt;=2.0&quot;
pytorch = &quot;&gt;=2.0&quot;

[tool.pixi.feature.viz.dependencies]
matplotlib = &quot;&gt;=3.8&quot;
seaborn = &quot;&gt;=0.13&quot;
plotly = &quot;&gt;=5.18&quot;

[tool.pixi.feature.dev.dependencies]
pytest = &quot;&gt;=7.0&quot;
pytest-cov = &quot;&gt;=4.0&quot;
black = &quot;&gt;=23.0&quot;
ruff = &quot;&gt;=0.1&quot;
mypy = &quot;&gt;=1.0&quot;

[tool.pixi.environments]
default = [&quot;core&quot;, &quot;dev&quot;]
ml = [&quot;core&quot;, &quot;ml&quot;, &quot;viz&quot;, &quot;dev&quot;]
prod = [&quot;core&quot;, &quot;ml&quot;]
ci = [&quot;core&quot;, &quot;ml&quot;, &quot;dev&quot;]
</code></pre>
<p><strong>Workflow:</strong></p>
<pre><code class="language-yaml">jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup CI environment
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: 'ci'
          activate-environment: 'ci'
          cache: 'true'  # Enable caching for complex environments

      - name: Lint code
        run: |
          black --check .
          ruff check .
          mypy src/

      - name: Run tests
        run: pytest --cov=src tests/

      - name: Test ML models
        run: |
          python -c &quot;import sklearn, xgboost, torch&quot;
          python scripts/test_model.py

  train-model:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup ML environment
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: 'ml'
          activate-environment: 'ml'
          cache: 'true'

      - name: Train model
        run: python scripts/train.py

      - name: Generate visualizations
        run: python scripts/visualize.py
</code></pre>
<p><strong>Result</strong>: Different jobs use optimized environments with only necessary dependencies.</p>
<h3 id="caching">Caching</h3>
<p><strong>Scenario</strong>: Speed up CI by caching the pixi environment.</p>
<h4 id="without-caching">Without Caching</h4>
<p><strong>Workflow:</strong></p>
<pre><code class="language-yaml">jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup Python
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          cache: 'false'  # No caching

      - name: Run tests
        run: pytest
</code></pre>
<p><strong>Time</strong>: ~5-10 minutes per run (full package installation each time)</p>
<h4 id="with-caching">With Caching</h4>
<p><strong>Workflow:</strong></p>
<pre><code class="language-yaml">jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Setup Python with caching
        uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          cache: 'true'  # Enable caching

      - name: Run tests
        run: pytest
</code></pre>
<p><strong>Time</strong>:
- First run: ~5-10 minutes (installs packages + saves cache)
- Subsequent runs: ~30 seconds (restores cache)
- After lock file change: ~5-10 minutes (cache miss, rebuilds)</p>
<p><strong>Cache behavior:</strong>
- âœ… <strong>Reads cache</strong>: All runs (PRs, pushes, manual)
- âœï¸ <strong>Writes cache</strong>: Only on <code>push</code> to <code>main</code> branch
- ğŸ”„ <strong>Updates cache</strong>: When <code>pixi.lock</code> changes</p>
<h4 id="validation-without-lock-file">Validation Without Lock File</h4>
<p>The action will fail if you enable caching without a lock file:</p>
<p><strong>Workflow (will fail):</strong></p>
<pre><code class="language-yaml">- name: Setup Python with caching
  uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    cache: 'true'  # âŒ Will fail - no pixi.lock!
</code></pre>
<p><strong>Error:</strong></p>
<pre><code>âŒ Cache is enabled but pixi.lock file does not exist!
To fix this issue:
 First run 'pixi install' locally to generate pixi.lock and then commit it to your repository
</code></pre>
<p><strong>How to fix:</strong></p>
<pre><code class="language-bash"># On your local machine
pixi install  # Generates pixi.lock
git add pixi.lock
git commit -m &quot;Add pixi lock file&quot;
git push
</code></pre>
<h2 id="lock-file-management">Lock File Management</h2>
<h3 id="lock-file-verification">Lock File Verification</h3>
<p>The action implements a <strong>lock-file-first</strong> approach:</p>
<ol>
<li><strong>Lock file is mandatory</strong>: Action fails immediately if <code>pixi.lock</code> doesn't exist</li>
<li><strong>Generated locally</strong>: Developers run <code>pixi install</code> on their machines</li>
<li><strong>Committed to repository</strong>: Lock file is version-controlled</li>
<li><strong>Verified in CI</strong>: Action validates (optionally) that lock matches dependencies</li>
</ol>
<p><strong>Benefits:</strong>
- ğŸ”’ <strong>Reproducibility</strong>: Everyone uses exact same versions
- ğŸ‘€ <strong>Visibility</strong>: Lock file changes are reviewable in PRs
- ğŸš« <strong>No surprises</strong>: CI doesn't install different versions than local
- âš¡ <strong>Speed</strong>: No lock resolution in CI</p>
<h3 id="frozen-vs-locked-modes">Frozen vs Locked Modes</h3>
<p>The <code>verify-lock</code> input controls how pixi uses the lock file:</p>
<h4 id="locked-mode-verify-lock-true-default">Locked Mode (<code>verify-lock: 'true'</code> - Default)</h4>
<p><strong>Command used</strong>: <code>pixi install --locked</code></p>
<p><strong>Behavior:</strong>
1. Reads <code>pixi.lock</code>
2. Compares with <code>pyproject.toml</code>
3. âŒ <strong>Fails if mismatch</strong> (dependencies added/changed without updating lock)
4. âœ… Installs exact versions from lock file</p>
<p><strong>Use when:</strong>
- Running CI/CD pipelines
- You want strict reproducibility
- You want to catch lock file drift</p>
<p><strong>Example:</strong></p>
<pre><code class="language-yaml">- name: Setup with verification
  uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    verify-lock: 'true'  # Default
</code></pre>
<p><strong>What it catches:</strong></p>
<pre><code class="language-toml"># pyproject.toml - added pandas
[tool.pixi.dependencies]
python = &quot;&gt;=3.11&quot;
numpy = &quot;&gt;=1.26&quot;
pandas = &quot;&gt;=2.0&quot;  # âš ï¸ NEW!

# pixi.lock - doesn't have pandas
# âŒ Action fails: &quot;Lock file is outdated!&quot;
</code></pre>
<h4 id="frozen-mode-verify-lock-false">Frozen Mode (<code>verify-lock: 'false'</code>)</h4>
<p><strong>Command used</strong>: <code>pixi install --frozen</code></p>
<p><strong>Behavior:</strong>
1. Reads <code>pixi.lock</code>
2. Installs exact versions from lock file
3. âœ… <strong>No verification</strong> - trusts lock file is correct
4. Faster (skips verification step)</p>
<p><strong>Use when:</strong>
- You're certain the lock file is up to date
- You want faster CI runs
- Lock file is updated automatically by bots/tools</p>
<p><strong>Example:</strong></p>
<pre><code class="language-yaml">- name: Setup without verification
  uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    verify-lock: 'false'
</code></pre>
<p><strong>Warning</strong>: Won't catch lock file drift, so use carefully.</p>
<h4 id="comparison-table">Comparison Table</h4>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Locked Mode</th>
<th>Frozen Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Command</strong></td>
<td><code>--locked</code></td>
<td><code>--frozen</code></td>
</tr>
<tr>
<td><strong>Verifies lock</strong></td>
<td>âœ… Yes</td>
<td>âŒ No</td>
</tr>
<tr>
<td><strong>Fails on drift</strong></td>
<td>âœ… Yes</td>
<td>âŒ No</td>
</tr>
<tr>
<td><strong>Speed</strong></td>
<td>Slower (verification)</td>
<td>Faster</td>
</tr>
<tr>
<td><strong>Safety</strong></td>
<td>Safer</td>
<td>Less safe</td>
</tr>
<tr>
<td><strong>Best for</strong></td>
<td>CI/CD</td>
<td>Trusted environments</td>
</tr>
<tr>
<td><strong>Default</strong></td>
<td>âœ… Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
<h4 id="when-to-use-each-mode">When to Use Each Mode</h4>
<p><strong>Use Locked Mode (<code>verify-lock: 'true'</code>) when:</strong>
- âœ… Running CI/CD pipelines
- âœ… Multiple contributors updating dependencies
- âœ… You want to enforce lock file updates
- âœ… Security is important (catch unexpected changes)</p>
<p><strong>Use Frozen Mode (<code>verify-lock: 'false'</code>) when:</strong>
- âœ… Lock file is auto-updated (Dependabot, Renovate)
- âœ… Single developer project
- âœ… Speed is critical (many CI runs)
- âœ… You have other verification mechanisms</p>
<h4 id="updating-lock-files">Updating Lock Files</h4>
<p><strong>Recommended workflow:</strong></p>
<ol>
<li><strong>Update dependencies locally:</strong>
   ```bash
   # Edit pyproject.toml
   vim pyproject.toml</li>
</ol>
<p># Update lock file
   pixi install</p>
<p># Verify it works
   pixi run pytest
   ```</p>
<ol>
<li>
<p><strong>Commit both files:</strong>
   <code>bash
   git add pyproject.toml pixi.lock
   git commit -m "Update numpy to 2.0"
   git push</code></p>
</li>
<li>
<p><strong>CI validates:</strong></p>
</li>
<li>PR runs with <code>verify-lock: 'true'</code></li>
<li>âœ… Passes because lock file matches</li>
<li>Reviewers see both files changed</li>
</ol>
<p><strong>What NOT to do:</strong></p>
<pre><code class="language-bash"># âŒ Don't edit only pyproject.toml without updating lock
vim pyproject.toml
git add pyproject.toml  # Missing pixi.lock!
git commit -m &quot;Update numpy&quot;
# CI will fail with &quot;Lock file is outdated&quot;
</code></pre>
<h2 id="environment-architecture">Environment Architecture</h2>
<h3 id="understanding-pixi-environments">Understanding Pixi Environments</h3>
<p>Pixi uses a feature-based system to compose environments:</p>
<p><strong>Features</strong> â†’ <strong>Environments</strong> â†’ <strong>Activation</strong></p>
<h4 id="1-features-dependency-groups">1. Features (Dependency Groups)</h4>
<p>Features define groups of related dependencies:</p>
<pre><code class="language-toml">[tool.pixi.feature.core.dependencies]
python = &quot;&gt;=3.11&quot;
numpy = &quot;&gt;=1.26&quot;

[tool.pixi.feature.dev.dependencies]
pytest = &quot;&gt;=7.0&quot;
black = &quot;&gt;=23.0&quot;

[tool.pixi.feature.ml.dependencies]
scikit-learn = &quot;&gt;=1.3&quot;
pytorch = &quot;&gt;=2.0&quot;
</code></pre>
<p><strong>Think of features as:</strong>
- ğŸ“¦ Reusable dependency sets
- ğŸ§© Building blocks for environments
- ğŸ¯ Logical groupings (core, dev, ML, viz, etc.)</p>
<h4 id="2-environments-feature-combinations">2. Environments (Feature Combinations)</h4>
<p>Environments combine multiple features:</p>
<pre><code class="language-toml">[tool.pixi.environments]
default = [&quot;core&quot;]                    # Just core
dev = [&quot;core&quot;, &quot;dev&quot;]                 # Core + dev tools
ml = [&quot;core&quot;, &quot;ml&quot;]                   # Core + ML packages
full = [&quot;core&quot;, &quot;dev&quot;, &quot;ml&quot;]          # Everything
</code></pre>
<p><strong>Think of environments as:</strong>
- ğŸ­ Different use cases (dev, test, prod)
- ğŸ”§ Job-specific setups
- ğŸ“Š Matrix test configurations</p>
<h4 id="3-activation-runtime-selection">3. Activation (Runtime Selection)</h4>
<p>The action installs environments and activates one:</p>
<pre><code class="language-yaml">environments: 'dev ml'           # Installs both
activate-environment: 'dev'      # Activates dev (adds to PATH)
</code></pre>
<p><strong>After activation:</strong>
- âœ… <code>python</code> â†’ Python from activated environment
- âœ… <code>pytest</code> â†’ If in activated environment
- âœ… Package imports work from activated environment
- âŒ Packages from other environments not in PATH (but can use <code>pixi run -e</code>)</p>
<h3 id="environment-lifecycle">Environment Lifecycle</h3>
<p><strong>Step-by-step what happens:</strong></p>
<ol>
<li><strong>Validation</strong>: Check <code>pixi.lock</code> exists</li>
<li><strong>Installation</strong>: Install pixi (if not cached)</li>
<li><strong>Lock Check</strong> (if <code>verify-lock: 'true'</code>): Verify lock matches pyproject.toml</li>
<li><strong>Environment Creation</strong>: Install specified environments
   <code>bash
   pixi install --locked  # or --frozen
   # Creates .pixi/envs/dev/, .pixi/envs/ml/, etc.</code></li>
<li><strong>Activation</strong>: Add environment to PATH
   <code>bash
   # Adds .pixi/envs/dev/bin to PATH</code></li>
<li><strong>Verification</strong>: Log environment info</li>
</ol>
<h3 id="directory-structure">Directory Structure</h3>
<p>After installation, your project looks like:</p>
<pre><code>my-project/
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ pixi.lock
â”œâ”€â”€ .pixi/                      # Created by pixi
â”‚   â”œâ”€â”€ envs/
â”‚   â”‚   â”œâ”€â”€ default/            # Each environment
â”‚   â”‚   â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ml/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ pixi                # Pixi binary
â”œâ”€â”€ src/
â””â”€â”€ tests/
</code></pre>
<p><strong>Caching caches</strong>: The entire <code>.pixi/</code> directory</p>
<h2 id="caching-strategy">Caching Strategy</h2>
<h3 id="how-caching-works">How Caching Works</h3>
<p><strong>Cache Key</strong>: <code>pixi-&lt;hash(pixi.lock)&gt;</code></p>
<p><strong>What's cached</strong>: Entire <code>.pixi/</code> directory containing:
- All installed environments
- Pixi binary
- Package metadata</p>
<p><strong>Cache flow:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Run starts     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hash pixi.lock  â”‚ â† Generate cache key
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Cache  â”‚
    â”‚ hit?   â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚        â”‚
   YES      NO
    â”‚        â”‚
    â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Restore â”‚ â”‚Install fresh â”‚
â”‚cache   â”‚ â”‚              â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚             â”‚
    â”‚             â–¼
    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Is push to   â”‚
    â”‚      â”‚ main branch? â”‚
    â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚             â”‚
    â”‚         â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚         â”‚       â”‚
    â”‚        YES     NO
    â”‚         â”‚       â”‚
    â”‚         â–¼       â–¼
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  Save   â”‚ â”‚  Skip  â”‚
    â”‚   â”‚  cache  â”‚ â”‚  save  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Done   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="cache-performance">Cache Performance</h3>
<p><strong>Typical timings:</strong></p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Time</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>No cache, small project</strong></td>
<td>1-2 min</td>
<td>Few packages</td>
</tr>
<tr>
<td><strong>No cache, large project</strong></td>
<td>5-10 min</td>
<td>Many packages (ML libs)</td>
</tr>
<tr>
<td><strong>Cache hit</strong></td>
<td>20-40 sec</td>
<td>Restore + verify</td>
</tr>
<tr>
<td><strong>Cache miss</strong></td>
<td>5-10 min</td>
<td>Full install + save</td>
</tr>
</tbody>
</table>
<p><strong>Factors affecting speed:</strong>
- Number of packages
- Package size (pytorch is large!)
- Number of environments
- Network speed (first install)</p>
<h3 id="cache-invalidation">Cache Invalidation</h3>
<p><strong>Automatic invalidation when:</strong>
- âœ… <code>pixi.lock</code> changes (new hash â†’ new key)
- âœ… GitHub clears old caches (7 days unused)</p>
<p><strong>Manual invalidation:</strong>
- Clear cache via GitHub UI (Settings â†’ Actions â†’ Caches)
- Change cache key (modify action or add version to <code>pyproject.toml</code>)</p>
<p><strong>Cache won't invalidate when:</strong>
- âŒ Only <code>pyproject.toml</code> changes (lock file unchanged)
- âŒ Code changes
- âŒ Non-dependency configuration changes</p>
<h3 id="cache-best-practices">Cache Best Practices</h3>
<p><strong>DO:</strong>
- âœ… Enable caching for stable projects
- âœ… Use caching in production CI
- âœ… Monitor cache hit rates
- âœ… Include lock file in commits</p>
<p><strong>DON'T:</strong>
- âŒ Enable caching when debugging dependency issues
- âŒ Rely on cache without lock file verification
- âŒ Cache in fork PRs (limited cache space)</p>
<p><strong>Optimal configuration:</strong></p>
<pre><code class="language-yaml"># Main branch - write cache
- uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    cache: 'true'
    verify-lock: 'true'  # Verify even with cache

# PR branches - read cache only (automatic)
# Same configuration, but cache-write is disabled automatically
</code></pre>
<h2 id="testing-guide">Testing Guide</h2>
<p>This action is comprehensively tested across multiple scenarios to ensure reliability. Reference the test workflow at <code>.github/workflows/test-python-setup-pixi.yml</code>.</p>
<h3 id="test-coverage-matrix">Test Coverage Matrix</h3>
<table>
<thead>
<tr>
<th>Test Job</th>
<th>Purpose</th>
<th>Key Validations</th>
<th>Fixture</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test-pixi-basic</code></td>
<td>Default behavior</td>
<td>Pixi and Python installed, packages available</td>
<td><code>test-pixi-basic/</code></td>
</tr>
<tr>
<td><code>test-pixi-default-environment</code></td>
<td>Default environment only</td>
<td>Only default environment installed</td>
<td><code>test-pixi-default-environment/</code></td>
</tr>
<tr>
<td><code>test-pixi-multiple-environments</code></td>
<td>Multiple environments</td>
<td>Multiple envs installed, correct one activated</td>
<td><code>test-pixi-multiple-environments/</code></td>
</tr>
<tr>
<td><code>test-pixi-environment-activation</code></td>
<td>Environment activation</td>
<td>Specific environment activated correctly</td>
<td><code>test-pixi-environment-activation/</code></td>
</tr>
<tr>
<td><code>test-pixi-lock-verification-valid</code></td>
<td>Valid lock file</td>
<td>Lock verification passes</td>
<td><code>test-pixi-lock-verification-valid/</code></td>
</tr>
<tr>
<td><code>test-pixi-lock-verification-outdated</code></td>
<td>Outdated lock handling</td>
<td>Fails with outdated lock file</td>
<td><code>test-pixi-lock-verification-outdated/</code></td>
</tr>
<tr>
<td><code>test-pixi-lock-verification-disabled</code></td>
<td>Skip lock check</td>
<td>Works with <code>verify-lock: 'false'</code></td>
<td><code>test-pixi-lock-verification-disabled/</code></td>
</tr>
<tr>
<td><code>test-pixi-lock-verification-validation</code></td>
<td>Missing lock file</td>
<td>Fails without lock file</td>
<td><code>test-pixi-lock-verification-validation/</code></td>
</tr>
<tr>
<td><code>test-pixi-caching-populate</code></td>
<td>Cache population</td>
<td>Cache created and packages installed</td>
<td><code>test-pixi-caching-populate/</code></td>
</tr>
<tr>
<td><code>test-pixi-caching-retrieve</code></td>
<td>Cache retrieval</td>
<td>Cache restored on subsequent runs</td>
<td><code>test-pixi-caching-retrieve/</code></td>
</tr>
<tr>
<td><code>test-pixi-caching-validation</code></td>
<td>Cache without lock</td>
<td>Fails when cache enabled without lock</td>
<td>-</td>
</tr>
<tr>
<td><code>test-pixi-matrix</code></td>
<td>Cross-platform matrix</td>
<td>Works on Linux/Windows/macOS with multiple environments</td>
<td><code>test-pixi-matrix/</code></td>
</tr>
<tr>
<td><code>test-pixi-error-scenarios</code></td>
<td>Error handling</td>
<td>Proper errors for missing lock, wrong environment</td>
<td><code>test-pixi-basic/</code></td>
</tr>
<tr>
<td><code>test-pixi-complex-project</code></td>
<td>Complex setup</td>
<td>Multiple features and environments</td>
<td><code>test-pixi-complex-project/</code></td>
</tr>
</tbody>
</table>
<h3 id="test-fixtures-location">Test Fixtures Location</h3>
<p>All test fixtures are located in <code>tests/data/pixi/</code> directory:</p>
<pre><code>tests/data/pixi/
â”œâ”€â”€ test-pixi-basic/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-default-environment/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-multiple-environments/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-environment-activation/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-lock-verification-valid/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-lock-verification-outdated/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-lock-verification-disabled/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-lock-verification-validation/
â”‚   â””â”€â”€ pyproject.toml  # No lock file (intentional)
â”œâ”€â”€ test-pixi-caching-populate/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-caching-retrieve/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â”œâ”€â”€ test-pixi-matrix/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ pixi.lock
â””â”€â”€ test-pixi-complex-project/
    â”œâ”€â”€ pyproject.toml
    â””â”€â”€ pixi.lock
</code></pre>
<h3 id="example-test-fixtures">Example Test Fixtures</h3>
<p><strong>test-pixi-basic/pyproject.toml:</strong></p>
<pre><code class="language-toml">[project]
name = &quot;test-pixi-basic&quot;
version = &quot;0.1.0&quot;
dependencies = []

[tool.pixi.workspace]
channels = [&quot;conda-forge&quot;]
platforms = [&quot;linux-64&quot;, &quot;osx-64&quot;, &quot;osx-arm64&quot;, &quot;win-64&quot;]

[tool.pixi.dependencies]
python = &quot;&gt;=3.11&quot;
numpy = &quot;&gt;=1.26&quot;
pytest = &quot;&gt;=7.0&quot;
</code></pre>
<p><strong>test-pixi-multiple-environments/pyproject.toml:</strong></p>
<pre><code class="language-toml">[project]
name = &quot;test-multi-env&quot;
version = &quot;0.1.0&quot;

[tool.pixi.workspace]
channels = [&quot;conda-forge&quot;]
platforms = [&quot;linux-64&quot;, &quot;osx-64&quot;, &quot;osx-arm64&quot;, &quot;win-64&quot;]

[tool.pixi.feature.core.dependencies]
python = &quot;&gt;=3.11&quot;
numpy = &quot;&gt;=1.26&quot;

[tool.pixi.feature.py311.dependencies]
python = &quot;3.11.*&quot;
pandas = &quot;&gt;=2.0&quot;

[tool.pixi.feature.py312.dependencies]
python = &quot;3.12.*&quot;
pandas = &quot;&gt;=2.0&quot;

[tool.pixi.environments]
default = [&quot;core&quot;]
py311 = [&quot;core&quot;, &quot;py311&quot;]
py312 = [&quot;core&quot;, &quot;py312&quot;]
</code></pre>
<p><strong>test-pixi-complex-project/pyproject.toml:</strong></p>
<pre><code class="language-toml">[project]
name = &quot;test-complex&quot;
version = &quot;0.1.0&quot;

[tool.pixi.workspace]
channels = [&quot;conda-forge&quot;]
platforms = [&quot;linux-64&quot;, &quot;osx-64&quot;, &quot;osx-arm64&quot;, &quot;win-64&quot;]

[tool.pixi.feature.core.dependencies]
python = &quot;&gt;=3.11&quot;
requests = &quot;&gt;=2.31&quot;

[tool.pixi.feature.ml.dependencies]
numpy = &quot;&gt;=1.26&quot;
scikit-learn = &quot;&gt;=1.3&quot;

[tool.pixi.feature.dev.dependencies]
pytest = &quot;&gt;=7.0&quot;
black = &quot;&gt;=23.0&quot;

[tool.pixi.environments]
default = [&quot;core&quot;, &quot;dev&quot;]
ml = [&quot;core&quot;, &quot;ml&quot;, &quot;dev&quot;]
prod = [&quot;core&quot;, &quot;ml&quot;]
</code></pre>
<h3 id="basic-test-setup">Basic Test Setup</h3>
<pre><code class="language-yaml">name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          cache: 'false'

      - run: pytest tests/
</code></pre>
<h3 id="matrix-testing-multiple-python-versions">Matrix Testing: Multiple Python Versions</h3>
<pre><code class="language-yaml">jobs:
  test:
    strategy:
      matrix:
        python-env: ['py310', 'py311', 'py312']
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: ${{ matrix.python-env }}
          activate-environment: ${{ matrix.python-env }}
          cache: 'false'

      - run: pytest
</code></pre>
<h3 id="matrix-testing-multiple-operating-systems">Matrix Testing: Multiple Operating Systems</h3>
<pre><code class="language-yaml">jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          cache: 'false'

      - run: pytest
</code></pre>
<h3 id="matrix-testing-combined">Matrix Testing: Combined</h3>
<pre><code class="language-yaml">jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        python-env: ['py311', 'py312']
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: ${{ matrix.python-env }}
          activate-environment: ${{ matrix.python-env }}
          cache: 'false'

      - run: pytest
</code></pre>
<h3 id="testing-multiple-environments-in-one-job">Testing Multiple Environments in One Job</h3>
<pre><code class="language-yaml">jobs:
  test-all:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          environments: 'dev test'
          activate-environment: 'dev'
          cache: 'false'

      - name: Lint with dev environment
        run: |
          black --check .
          ruff check .

      - name: Test with test environment
        run: pixi run -e test pytest --cov
</code></pre>
<h3 id="lock-file-verification-tests">Lock File Verification Tests</h3>
<h4 id="test-valid-lock-file">Test Valid Lock File</h4>
<pre><code class="language-yaml">jobs:
  test-valid-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          verify-lock: 'true'  # Should pass
          cache: 'false'

      - run: pytest
</code></pre>
<h4 id="test-outdated-lock-file-should-fail">Test Outdated Lock File (Should Fail)</h4>
<pre><code class="language-yaml">jobs:
  test-outdated-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      # Modify pyproject.toml to make lock outdated
      - run: |
          echo &quot;&quot; &gt;&gt; pyproject.toml
          echo &quot;[tool.pixi.dependencies]&quot; &gt;&gt; pyproject.toml
          echo &quot;newpackage = \&quot;&gt;=1.0\&quot;&quot; &gt;&gt; pyproject.toml

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        id: setup
        continue-on-error: true
        with:
          verify-lock: 'true'  # Should fail
          cache: 'false'

      - name: Verify it failed
        if: steps.setup.outcome != 'failure'
        run: |
          echo &quot;ERROR: Should have failed with outdated lock&quot;
          exit 1
</code></pre>
<h4 id="test-without-lock-file-should-fail">Test Without Lock File (Should Fail)</h4>
<pre><code class="language-yaml">jobs:
  test-no-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - run: rm pixi.lock  # Remove lock file

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        id: setup
        continue-on-error: true
        with:
          cache: 'false'

      - name: Verify it failed
        if: steps.setup.outcome != 'failure'
        run: |
          echo &quot;ERROR: Should have failed without lock file&quot;
          exit 1
</code></pre>
<h3 id="caching-tests">Caching Tests</h3>
<h4 id="test-cache-population">Test Cache Population</h4>
<pre><code class="language-yaml">jobs:
  cache-populate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          cache: 'true'

      - run: pytest
</code></pre>
<h4 id="test-cache-retrieval">Test Cache Retrieval</h4>
<pre><code class="language-yaml">jobs:
  cache-populate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        with:
          cache: 'true'

      - run: pytest

  cache-retrieve:
    runs-on: ubuntu-latest
    needs: cache-populate
    steps:
      - uses: actions/checkout@v5

      - uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
        id: setup
        with:
          cache: 'true'

      # Second run should be much faster
      - run: pytest
</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues">Common Issues</h3>
<h4 id="issue-pixilock-file-does-not-exist">Issue: "pixi.lock file does not exist"</h4>
<p><strong>Error message:</strong></p>
<pre><code>âŒ pixi.lock file does not exist!
To fix this issue:
 Run 'pixi install' locally to generate pixi.lock and commit it to your repository
</code></pre>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># On your local machine
pixi install
git add pixi.lock
git commit -m &quot;Add pixi lock file&quot;
git push
</code></pre>
<h4 id="issue-lock-file-is-outdated">Issue: "Lock file is outdated"</h4>
<p><strong>Error message:</strong></p>
<pre><code>The pixi.lock file is outdated. Please run `pixi install` to update it.
</code></pre>
<p><strong>Cause:</strong> You modified <code>pyproject.toml</code> without updating the lock file.</p>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Update lock file
pixi install

# Commit both files
git add pyproject.toml pixi.lock
git commit -m &quot;Update dependencies&quot;
git push
</code></pre>
<h4 id="issue-cache-not-working">Issue: Cache not working</h4>
<p><strong>Symptoms:</strong> Every run takes 5-10 minutes even with <code>cache: 'true'</code></p>
<p><strong>Possible causes:</strong></p>
<ol>
<li>
<p><strong>Lock file keeps changing:</strong>
   <code>bash
   # Check if lock file is in .gitignore
   git check-ignore pixi.lock
   # Should output nothing (not ignored)</code></p>
</li>
<li>
<p><strong>Running on PR from fork:</strong></p>
</li>
<li>Forks have limited cache access</li>
<li>
<p>This is a GitHub limitation</p>
</li>
<li>
<p><strong>Cache was cleared:</strong></p>
</li>
<li>Check GitHub Actions â†’ Caches</li>
<li>Old caches are auto-deleted after 7 days</li>
</ol>
<p><strong>Solution:</strong>
- Ensure <code>pixi.lock</code> is committed
- Check cache hit/miss in logs
- For fork PRs, accept slower runs</p>
<h4 id="issue-environment-not-found">Issue: "Environment not found"</h4>
<p><strong>Error message:</strong></p>
<pre><code>Error: Environment 'ml' not found
</code></pre>
<p><strong>Cause:</strong> Trying to activate an environment that doesn't exist in <code>pyproject.toml</code> or wasn't installed.</p>
<p><strong>Solution:</strong></p>
<pre><code class="language-yaml"># Wrong
with:
  environments: 'dev'
  activate-environment: 'ml'  # âŒ ml not installed!

# Correct
with:
  environments: 'dev ml'       # âœ… Install both
  activate-environment: 'ml'   # âœ… Now can activate ml
</code></pre>
<h4 id="issue-package-not-found-after-setup">Issue: Package not found after setup</h4>
<p><strong>Symptoms:</strong> <code>ModuleNotFoundError: No module named 'numpy'</code> even though it's in <code>pyproject.toml</code></p>
<p><strong>Possible causes:</strong></p>
<ol>
<li>
<p><strong>Wrong environment activated:</strong>
   ```yaml
   # Package is in 'ml' environment but 'dev' is active
   with:
     environments: 'dev ml'
     activate-environment: 'dev'  # numpy might not be here</p>
</li>
<li>
<p>run: python -c "import numpy"  # âŒ Fails
   ```</p>
</li>
<li>
<p><strong>Package in wrong feature:</strong>
   Check your <code>pyproject.toml</code> environment definitions</p>
</li>
</ol>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Check which environment has the package
pixi list -e dev | grep numpy
pixi list -e ml | grep numpy

# Either switch environment or add package to current environment
</code></pre>
<h4 id="issue-different-versions-locally-vs-ci">Issue: Different versions locally vs CI</h4>
<p><strong>Symptoms:</strong> Works locally but fails in CI (or vice versa)</p>
<p><strong>Cause:</strong> Lock file not synchronized</p>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Regenerate lock file locally
rm pixi.lock
pixi install

# Commit and push
git add pixi.lock
git commit -m &quot;Regenerate lock file&quot;
git push
</code></pre>
<h4 id="issue-windows-specific-path-issues">Issue: Windows-specific path issues</h4>
<p><strong>Symptoms:</strong> Works on Linux/Mac but fails on Windows</p>
<p><strong>Cause:</strong> Path separators or shell-specific commands</p>
<p><strong>Solution:</strong></p>
<pre><code class="language-yaml"># Use pixi tasks instead of shell commands
# In pyproject.toml:
[tool.pixi.tasks]
test = &quot;pytest tests/&quot;

# In workflow:
- run: pixi run test  # Cross-platform!
</code></pre>
<h4 id="issue-slow-installation-even-with-cache">Issue: Slow installation even with cache</h4>
<p><strong>Symptoms:</strong> Cache hits but still takes 2-3 minutes</p>
<p><strong>Cause:</strong> Lock verification and environment activation take time</p>
<p><strong>Solution:</strong></p>
<pre><code class="language-yaml"># For trusted environments, disable verification
with:
  cache: 'true'
  verify-lock: 'false'  # Faster but less safe
</code></pre>
<h3 id="debug-mode">Debug Mode</h3>
<p>To get more information about what's happening:</p>
<pre><code class="language-yaml">- uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    cache: 'false'

# Add debug steps
- name: Debug environment info
  run: |
    echo &quot;Pixi version:&quot;
    pixi --version

    echo &quot;Available environments:&quot;
    pixi info

    echo &quot;Active Python:&quot;
    which python
    python --version

    echo &quot;Installed packages:&quot;
    pixi list

    echo &quot;PATH:&quot;
    echo $PATH
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-always-commit-lock-files">1. Always Commit Lock Files</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-bash">git add pyproject.toml pixi.lock
git commit -m &quot;Update numpy to 2.0&quot;
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-bash">git add pyproject.toml
# Missing pixi.lock - CI will fail!
</code></pre>
<h3 id="2-use-locked-mode-in-ci">2. Use Locked Mode in CI</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-yaml">with:
  verify-lock: 'true'  # Catch drift
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-yaml">with:
  verify-lock: 'false'  # Silent failures
</code></pre>
<p><strong>Exception:</strong> Disable when lock is auto-updated by bots</p>
<h3 id="3-enable-caching-for-stable-projects">3. Enable Caching for Stable Projects</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-yaml"># Stable project with infrequent dependency changes
with:
  cache: 'true'
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-yaml"># When debugging dependency issues
with:
  cache: 'true'  # Cache might mask issues
</code></pre>
<h3 id="4-use-minimal-environments">4. Use Minimal Environments</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-yaml"># Install only what you need
jobs:
  lint:
    steps:
      - uses: .../pixi@v1
        with:
          environments: 'dev'  # Just linting tools

  test:
    steps:
      - uses: .../pixi@v1
        with:
          environments: 'test'  # Just test deps
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-yaml"># Install everything everywhere
jobs:
  lint:
    steps:
      - uses: .../pixi@v1
        with:
          environments: 'dev test ml viz'  # Overkill!
</code></pre>
<h3 id="5-one-environment-activation-per-job">5. One Environment Activation Per Job</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-yaml">- uses: .../pixi@v1
  with:
    environments: 'dev'
    activate-environment: 'dev'

# All subsequent steps use dev environment
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-yaml"># Trying to activate multiple environments (not possible)
- uses: .../pixi@v1
  with:
    activate-environment: 'dev'

- uses: .../pixi@v1  # âŒ Second activation
  with:
    activate-environment: 'test'
</code></pre>
<p><strong>If you need multiple environments</strong>, use <code>pixi run -e</code>:</p>
<pre><code class="language-yaml">- uses: .../pixi@v1
  with:
    environments: 'dev test'
    activate-environment: 'dev'

- run: black --check .  # Uses dev

- run: pixi run -e test pytest  # Uses test
</code></pre>
<h3 id="6-organize-dependencies-by-purpose">6. Organize Dependencies by Purpose</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-toml">[tool.pixi.feature.core.dependencies]
# Core runtime dependencies
numpy = &quot;&gt;=1.26&quot;
pandas = &quot;&gt;=2.0&quot;

[tool.pixi.feature.dev.dependencies]
# Development tools
black = &quot;&gt;=23.0&quot;
ruff = &quot;&gt;=0.1&quot;

[tool.pixi.feature.test.dependencies]
# Testing tools
pytest = &quot;&gt;=7.0&quot;
pytest-cov = &quot;&gt;=4.0&quot;

[tool.pixi.environments]
default = [&quot;core&quot;]
dev = [&quot;core&quot;, &quot;dev&quot;]
ci = [&quot;core&quot;, &quot;test&quot;]
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-toml">[tool.pixi.dependencies]
# Everything in one place
numpy = &quot;&gt;=1.26&quot;
pandas = &quot;&gt;=2.0&quot;
black = &quot;&gt;=23.0&quot;
pytest = &quot;&gt;=7.0&quot;
# No organization!
</code></pre>
<h3 id="7-use-descriptive-environment-names">7. Use Descriptive Environment Names</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-toml">[tool.pixi.environments]
default = [&quot;core&quot;]
dev = [&quot;core&quot;, &quot;dev-tools&quot;]
test-py311 = [&quot;core&quot;, &quot;test&quot;, &quot;py311&quot;]
test-py312 = [&quot;core&quot;, &quot;test&quot;, &quot;py312&quot;]
prod = [&quot;core&quot;]
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-toml">[tool.pixi.environments]
env1 = [&quot;core&quot;]
env2 = [&quot;core&quot;, &quot;dev&quot;]
myenv = [&quot;core&quot;, &quot;test&quot;]
</code></pre>
<h3 id="8-document-environment-purpose">8. Document Environment Purpose</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-toml">[tool.pixi.environments]
# Core dependencies only - minimal install
default = [&quot;core&quot;]

# Development environment - includes linting and formatting tools
dev = [&quot;core&quot;, &quot;dev-tools&quot;]

# CI testing environment - includes test runners and coverage
ci = [&quot;core&quot;, &quot;test&quot;]

# Production environment - runtime dependencies only
prod = [&quot;core&quot;]
</code></pre>
<h3 id="9-pin-major-python-version">9. Pin Major Python Version</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-toml">[tool.pixi.dependencies]
python = &quot;&gt;=3.11,&lt;3.13&quot;  # Explicit range
</code></pre>
<p>âŒ <strong>DON'T:</strong></p>
<pre><code class="language-toml">[tool.pixi.dependencies]
python = &quot;&gt;=3.11&quot;  # Too permissive
</code></pre>
<h3 id="10-test-lock-file-verification-in-ci">10. Test Lock File Verification in CI</h3>
<p>âœ… <strong>DO:</strong></p>
<pre><code class="language-yaml">jobs:
  validate-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: .../pixi@v1
        with:
          verify-lock: 'true'  # Enforce verification
          cache: 'false'
</code></pre>
<p>This catches PRs with outdated lock files early.</p>
<h2 id="migration-guide">Migration Guide</h2>
<h3 id="from-setup-python-pip">From <code>setup-python</code> + <code>pip</code></h3>
<p><strong>Before (pip):</strong></p>
<pre><code class="language-yaml">- uses: actions/setup-python@v5
  with:
    python-version: '3.11'
    cache: 'pip'

- run: pip install -r requirements.txt
</code></pre>
<p><strong>After (pixi):</strong></p>
<pre><code class="language-yaml">- uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    cache: 'true'
</code></pre>
<p><strong>Migration steps:</strong>
1. Create <code>pyproject.toml</code> with pixi configuration
2. Run <code>pixi install</code> locally to generate <code>pixi.lock</code>
3. Commit both files
4. Update workflow to use pixi action</p>
<h3 id="from-setup-python-conda">From <code>setup-python</code> + <code>conda</code></h3>
<p><strong>Before (conda):</strong></p>
<pre><code class="language-yaml">- uses: conda-incubator/setup-miniconda@v3
  with:
    python-version: '3.11'
    environment-file: environment.yml
</code></pre>
<p><strong>After (pixi):</strong></p>
<pre><code class="language-yaml">- uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    cache: 'true'
</code></pre>
<p><strong>Migration steps:</strong>
1. Convert <code>environment.yml</code> to <code>pyproject.toml</code> pixi format
2. Run <code>pixi install</code> to generate lock file
3. Commit files
4. Update workflow</p>
<h3 id="from-mamba-orgsetup-micromamba">From <code>mamba-org/setup-micromamba</code></h3>
<p><strong>Before (micromamba):</strong></p>
<pre><code class="language-yaml">- uses: mamba-org/setup-micromamba@v1
  with:
    environment-file: environment.yml
    cache-environment: true
</code></pre>
<p><strong>After (pixi):</strong></p>
<pre><code class="language-yaml">- uses: Serapieum-of-alex/github-actions/actions/python-setup/pixi@v1
  with:
    cache: 'true'
</code></pre>
<p>Pixi is faster than micromamba and has better lock file support!</p>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><strong>Pixi Documentation</strong>: https://prefix.dev/docs/pixi</li>
<li><strong>Pixi GitHub</strong>: https://github.com/prefix-dev/pixi</li>
<li><strong>Conda-forge</strong>: https://conda-forge.org/</li>
<li><strong>Action Source</strong>: <code>Serapieum-of-alex/github-actions/actions/python-setup/pixi</code></li>
</ul>
<h2 id="examples-repository">Examples Repository</h2>
<p>See the test suite for comprehensive examples:
- <code>.github/workflows/test-python-setup-pixi.yml</code> - All test scenarios
- <code>tests/data/pixi/</code> - Example configurations</p>
<h2 id="support">Support</h2>
<p>For issues or questions:
1. Check <a href="#troubleshooting">Troubleshooting</a>
2. Review <a href=".github/workflows/test-python-setup-pixi.yml">test examples</a>
3. Open an issue in the repository</p>
<hr />
<p><strong>Version</strong>: 1.0.0<br />
<strong>Last Updated</strong>: January 2026<br />
<strong>Compatibility</strong>: Linux, macOS, Windows<br />
<strong>Pixi Version</strong>: v0.49.0</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>
        <script src="../../js/version-select.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
